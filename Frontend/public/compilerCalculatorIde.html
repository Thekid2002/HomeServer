<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Compiler Calculator</title>
    <base href="/HomeServer/Frontend/public/">
    <link rel="stylesheet" href="/HomeServer/Frontend/public/compilerCalculator.css">
    <link rel="stylesheet" href="/HomeServer/Frontend/public/compilerCalculatorIde.css">
    <link rel="stylesheet" href="/HomeServer/Frontend/public/sharedStyles.css">
    <!--<link rel="stylesheet" href="compilerCalculator.css">
    <link rel="stylesheet" href="compilerCalculatorIde.css">
    <link rel="stylesheet" href="sharedStyles.css">-->
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <!-- CodeMirror Darcula Theme -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/darcula.min.css">
</head>
<body>
<div class="page">
    <div class="toolbar">
        <div class="options-buttons">
            <button onclick="goToPage('simpleCalculator')">Simple Calculator</button>
            <button onclick="goToPage('interpreterCalculator')">Interpreter Calculator</button>
            <button onclick="goToPage('compilerCalculator')">Compiler Calculator</button>
            <button onclick="goToPage('compilerCalculatorIde')">IDE</button>
            <button onclick="goToPage('carlInstructions')">Carl Instructions</button>
        </div>
        <div class="example-choice">
            <select id="examples">

            </select>
            <div>
                <input type="checkbox" id="optimize" name="optimize" value="optimize">
                <label for="optimize">Optimize</label>
            </div>
        </div>
        <div class="compile-buttons">
            <button onclick="compileAndExecute()">Play</button>
            <button onclick="debug()">Debug</button>
        </div>
    </div>
    <div class="page-layout">
        <div id="code-editor-window" class="code-editor-window">
            <div id="pull-code-editor" class="puller">
                <p>Code Editor</p>
            </div>
            <textarea id="code" class="code-editor" spellcheck="false" autocorrect="off" autocomplete="off" autocapitalize="off"></textarea>
        </div>
        <div id="terminal-window" class="terminal-window">
            <div id="pull-terminal" class="puller">
                <p>Terminal</p>
            </div>
            <textarea id="terminal" class="terminal" spellcheck="false" autocorrect="off" autocomplete="off" autocapitalize="off"></textarea>
        </div>
    </div>
</div>
<!-- CodeMirror JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
<!-- CodeMirror Modes (for syntax highlighting) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
<!-- Optionally include other modes if you need -->
<script src="libwabt.js"></script>
<script type="module">
    import {goToPage} from './navigation.js';
    import {compile, execute, compileAndExecute} from './compilerCalculator.js';
    window.compile = compile;
    window.execute = execute;
    window.goToPage = goToPage;
    window.compileAndExecute = compileAndExecute;

    // Initialize CodeMirror on the textarea
    const codeTextarea = document.getElementById('code');
    const codeEditor = CodeMirror.fromTextArea(codeTextarea, {
        lineNumbers: true,
        mode: 'javascript', // Set mode according to the language you're editing
        theme: 'default', // Set the theme to Darcula
    });

    const terminal = CodeMirror.fromTextArea(document.getElementById('terminal'), {
        lineNumbers: true,
        mode: 'javascript',
        theme: 'default',
        readOnly: true,
    });
/// Attach the editor instance to the window for further use
    window.codeEditor = codeEditor;
    window.terminal = terminal;

    terminal.on('change', () => {
        setTimeout(() => {
            terminal.scrollTo(null, terminal.getScrollInfo().height);
        }, 10);
    });

    const terminalWindow = document.getElementById("terminal-window");
    let terminalResizer = document.getElementById('pull-terminal');

    const codeEditorWindow = document.getElementById("code-editor-window");
    let codeEditorResizer = document.getElementById('pull-code-editor');

    let originalSize = 0;
    let originalCoordinate = 0;

    terminalResizer.addEventListener('mousedown', startResizeHeight);
    terminalResizer.addEventListener('touchstart', startResizeHeight);

    codeEditorResizer.addEventListener('mousedown', startResizeWidth);
    codeEditorResizer.addEventListener('touchstart', startResizeWidth);

    function startResizeHeight(e) {
        e.preventDefault();
        originalSize = parseFloat(getComputedStyle(terminalWindow, null).getPropertyValue('height').replace('px', ''));
        originalCoordinate = e.pageY || e.touches[0].pageY;
        window.addEventListener('mousemove', resizeHeight);
        window.addEventListener('touchmove', resizeHeight);
        window.addEventListener('mouseup', stopResize);
        window.addEventListener('touchend', stopResize);
    }

    function startResizeWidth(e) {
        e.preventDefault();
        originalSize = parseFloat(getComputedStyle(codeEditorWindow, null).getPropertyValue('width').replace('px', ''));
        originalCoordinate = e.pageX || e.touches[0].pageX;
        window.addEventListener('mousemove', resizeWidth);
        window.addEventListener('touchmove', resizeWidth);
        window.addEventListener('mouseup', stopResize);
        window.addEventListener('touchend', stopResize);
    }

    function resizeHeight(e) {
        const newSize = originalSize - ((e.pageY || e.touches[0].pageY) - originalCoordinate);
        terminalWindow.style.height = `${newSize}px`;
        codeEditorWindow.style.height = `${window.innerHeight - 50 - newSize}px`;
    }

    function resizeWidth(e) {
        const newSize = originalSize - ((e.pageX || e.touches[0].pageX) - originalCoordinate);
        codeEditorWindow.style.width = `${newSize}px`;
    }

    function stopResize() {
        window.removeEventListener('mousemove', resizeHeight);
        window.removeEventListener('touchmove', resizeHeight);
        window.removeEventListener('mousemove', resizeWidth);
        window.removeEventListener('touchmove', resizeWidth);
        window.removeEventListener('mouseup', stopResize);
        window.removeEventListener('touchend', stopResize);
    }
</script>
<script src="examples.js"></script>
</body>
</html>
